#!/usr/bin/env python3
"""========================================================================
Purpose:
    The purpose of this script is to build a LaTeX and python combination.
Author:
    Emilio Torres
========================================================================"""
#=========================================================================#
# Preamble                                                                #
#=========================================================================#
import sys
import os
import platform
from subprocess import call
#=========================================================================#
# User defined functions                                                  #
#=========================================================================#
#-------------------------------------------------------------------------#
# Building pdf                                                            #
#-------------------------------------------------------------------------#
def pdf_build(
        fileName):

    """ Building the pdf using pdflatex """
    #---------------------------------------------------------------------#
    # Pdflatex                                                            #
    #---------------------------------------------------------------------#
    call(["pdflatex", fileName])
    #---------------------------------------------------------------------#
    # Creating index                                                      #
    #---------------------------------------------------------------------#
    call(["makeindex", fileName])
    #---------------------------------------------------------------------#
    # Create list of abbreviations                                        #
    #---------------------------------------------------------------------#
    call(["makeindex",fileName+".nlo","-s","nomencl.ist","-o",\
            fileName+".nls"])
    #---------------------------------------------------------------------#
    # Create bibliography                                                 #
    #---------------------------------------------------------------------#
    call(["bibtex", fileName])
    #---------------------------------------------------------------------#
    # Update pdf                                                          #
    #---------------------------------------------------------------------#
    call(["pdflatex", fileName])
    #---------------------------------------------------------------------#
    # Once more for last links                                            #
    #---------------------------------------------------------------------#
    call(["pdflatex", fileName])
    #---------------------------------------------------------------------#
    # Embed fonts                                                         #
    #---------------------------------------------------------------------#
    system  = platform.system()
    if system == "Linux":
        call(["gs", "-dNOPAUSE", "-dBATCH", "-sDEVICE=pdfwrite",\
                "-dPDFSETTINGS=/prepress",\
                "-sFONTPATH='/usr/share/fonts/truetype/msttcorefonts'",\
                "-dEmbedAllFonts=true", "-sOutputFile=tmp.pdf", "-f",\
                fileName+".pdf"])
    return
#-------------------------------------------------------------------------#
# Executing the python                                                    #
#-------------------------------------------------------------------------#
def python_exec(
        file_name):

    """ Executing the supporting python """
    #---------------------------------------------------------------------#
    # Executing python                                                    #
    #---------------------------------------------------------------------#
    call(["python3", file_name])

    return
#=========================================================================#
# Main                                                                    #
#=========================================================================#
if __name__ == "__main__":
    #---------------------------------------------------------------------#
    # file names                                                          #
    #---------------------------------------------------------------------#
    pwd         = os.getcwd()
    sep         = os.sep
    py_file     = "filter-plot.py" 
    latex_file  = "BS-tau"
    #---------------------------------------------------------------------#
    # Executing python                                                    #
    #---------------------------------------------------------------------#
    os.chdir("Python/")
    if py_file is not False:
        python_exec(py_file)
        input("\n\n Press enter to continue ...")
    os.chdir(pwd)
    #---------------------------------------------------------------------#
    # Executing LaTeX                                                     #
    #---------------------------------------------------------------------#
    os.chdir("LaTeX/")
    pdf_build(latex_file)
    os.chdir(pwd)
    #---------------------------------------------------------------------#
    # Copying to main directory                                           #
    #---------------------------------------------------------------------#
    call(["cp", "LaTeX/" + latex_file + ".pdf", "."])
    sys.exit("**** Successful Run ****")
